# 数据表设计

## 用户表（改造）

```mysql
CREATE TABLE `user` (
  `id` int NOT NULL AUTO_INCREMENT,
  `avatar` longtext COMMENT '用户头像URL',
  `name` longtext COMMENT '用户昵称',
  `sex` int DEFAULT '0' COMMENT '性别：0未知 1男 2女',
  `age` int DEFAULT '0' COMMENT '年龄',
  `birthday` longtext COMMENT '生日',
  `phone` varchar(64) DEFAULT NULL COMMENT '手机号（登录/联系）',
  `wechart_code` varchar(255) DEFAULT NULL COMMENT '微信登录临时code（wx.login获取，一次性）',
  `wechat_open_id` longtext COMMENT '微信 openId（用户唯一标识）',
  `token` longtext COMMENT '登录态 token',
  `password` longtext COMMENT '用户密码（非微信登录或后台使用）',
  `first_area_id` int DEFAULT '0' COMMENT '一级地区ID（省）',
  `second_area_id` int DEFAULT '0' COMMENT '二级地区ID（市）',
  `third_area_id` int DEFAULT '0' COMMENT '三级地区ID（区/县）',
  `address` longtext COMMENT '详细地址',
  `longitude` double DEFAULT '0' COMMENT '经度',
  `latitude` double DEFAULT '0' COMMENT '纬度',
  `type` int DEFAULT '0' COMMENT '用户类型：0普通用户 1商家 2管理员',
  `status` int DEFAULT '0' COMMENT '用户状态：0正常 1禁用 2注销',
  `integral` bigint unsigned NOT NULL DEFAULT '0' COMMENT '用户积分',
  `collect_num` bigint unsigned DEFAULT '0' COMMENT '收藏数量',
  `buy_num` bigint unsigned DEFAULT '0' COMMENT '购买次数',
  `invite_id` bigint DEFAULT '0' COMMENT '邀请人用户ID',
  `invite_num` bigint unsigned DEFAULT '0' COMMENT '成功邀请人数',
  `first_recharge` longtext COMMENT '首次充值标识/记录',
  `total_recharge` double DEFAULT '0' COMMENT '累计充值金额',
  `device_model` longtext COMMENT '设备型号',
  `ip` longtext COMMENT '最近登录IP',
  `contact_voucher_num` int DEFAULT '0' COMMENT '联系券余额', 
  `create_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
  `update_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4882 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='用户'
```

## 订单表（新建）

```mysql
CREATE TABLE `order` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `order_no` varchar(32) NOT NULL COMMENT '订单号（业务唯一）',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `amount_total` decimal(10,2) NOT NULL COMMENT '订单总金额（应付）',
  `amount_paid` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '实付金额',
  `currency` char(3) NOT NULL DEFAULT 'CNY' COMMENT '币种',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '订单状态：1=待支付 2=已支付 3=已取消 4=已退款',
  `pay_channel` varchar(32) DEFAULT NULL COMMENT '支付渠道：wxpay/alipay/stripe等',
  `pay_trade_no` varchar(64) DEFAULT NULL COMMENT '第三方支付单号',
  `paid_at` datetime(3) DEFAULT NULL COMMENT '支付时间',
  `canceled_at` datetime(3) DEFAULT NULL COMMENT '取消时间',
  `refunded_at` datetime(3) DEFAULT NULL COMMENT '退款时间',
  `remark` varchar(255) DEFAULT NULL COMMENT '订单备注（可用于客服）',
  `create_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
  `update_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_buyer_status_time` (`buyer_user_id`, `status`, `create_at`),
  KEY `idx_status_create_at` (`status`, `create_at`)
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_0900_ai_ci
  COMMENT='订单主表';


CREATE TABLE `order_item` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `order_id` bigint NOT NULL COMMENT '订单ID（order.id）',
  `product_type` tinyint NOT NULL COMMENT '商品类型：1=置顶套餐 2=联系券套餐',
  `rule_id` bigint NOT NULL COMMENT '规则ID：置顶=top_recharge_rule.id；联系券=contact_voucher_recharge_rule.id',
  `title_snapshot` varchar(64) NOT NULL COMMENT '套餐名称快照',
  `unit_price_snapshot` decimal(10,2) NOT NULL COMMENT '单价快照（元）',

  -- 置顶相关快照字段（联系券可为0）
  `target_type` tinyint DEFAULT NULL COMMENT '置顶对象类型：1=职位(job) 2=简历(resume)（联系券可为NULL）',
  `target_id` bigint DEFAULT NULL COMMENT '置顶对象ID（如job_id/resume_id；联系券可为NULL）',

  -- 联系券相关快照字段（置顶可为0）
  `purpose_user_id` bigint DEFAULT NULL COMMENT '被联系对象所属用户ID',

  `create_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
  `update_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',

  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_product_rule` (`product_type`, `rule_id`),
  KEY `idx_target` (`target_type`, `target_id`)
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_0900_ai_ci
  COMMENT='订单明细表（记录置顶/联系券套餐与下单快照）';

```

## 招聘信息表（复用）

```mysql
# 新
Create Table: CREATE TABLE `job` (
  `id` int NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `user_id` bigint DEFAULT NULL COMMENT '发布岗位的用户ID，对应 user.id',
  `positions` varchar(128) NOT NULL COMMENT '岗位名称/标签',
  `company_name` varchar(128) DEFAULT NULL COMMENT '企业名称',
  `longitude` double DEFAULT NULL COMMENT '岗位所在地经度',
  `latitude` double DEFAULT NULL COMMENT '岗位所在地纬度',
  `address` longtext COMMENT '岗位详细地址',
  `contact` varchar(64) NOT NULL COMMENT '联系方式（手机号/微信）',
  `description` longtext COMMENT '岗位描述',
  `photo_urls` longtext COMMENT '岗位相关图片URL列表（支持多个，逗号分割）',
  `status` int DEFAULT NULL COMMENT '状态：1生效 2删除 3暂停 4待审核 5审核拒绝',
  `fail_reason` longtext COMMENT '审核失败原因',
  `first_area_id` int DEFAULT NULL COMMENT '一级地区ID（省）',
  `first_area_des` longtext COMMENT '一级地区名称',
  `second_area_id` int DEFAULT NULL COMMENT '二级地区ID（市）',
  `second_area_des` longtext COMMENT '二级地区名称',
  `third_area_id` int DEFAULT NULL COMMENT '三级地区ID（区/县）',
  `third_area_des` longtext COMMENT '三级地区名称',
  `four_area_id` int DEFAULT NULL COMMENT '四级地区ID（街道/商圈）',
  `four_area_des` longtext COMMENT '四级地区名称',
  `create_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
  `update_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
  `audit_time` datetime DEFAULT NULL COMMENT '审核通过时间',
  `refresh_time` bigint DEFAULT NULL COMMENT '刷新时间',
  `is_top` tinyint(1) DEFAULT NULL COMMENT '是否置顶',
  `is_buy_top` tinyint(1) DEFAULT NULL COMMENT '是否购买置顶',
  `top_hour` int DEFAULT NULL COMMENT '置顶时长（小时）',
  `top_start_time` datetime DEFAULT NULL COMMENT '置顶开始时间',
  `top_end_time` datetime DEFAULT NULL COMMENT '置顶结束时间',
  PRIMARY KEY (`id`),
  KEY `idx_job_user_id` (`user_id`),
  KEY `idx_job_status` (`status`),
  KEY `idx_job_refresh_time` (`refresh_time`),
  KEY `idx_job_top_valid` (`is_top`,`top_start_time`,`top_end_time`)
) ENGINE=InnoDB AUTO_INCREMENT=1173 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='岗位详情表'
```

## 沟通记录表（复用）

```mysql
CREATE TABLE `contact_history` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '联系记录主键ID，自增',
  `user_id` bigint DEFAULT NULL COMMENT '发起联系的用户ID，对应 user.id',
  `purpose_id` bigint DEFAULT NULL COMMENT '被联系的业务对象ID（如招聘ID/简历ID/招租ID）',
  `purpose_type` int DEFAULT NULL COMMENT '联系对象类型：1=招聘 2=求职 3=招租',
  `purpose_user_id` bigint DEFAULT NULL COMMENT '被联系用户ID',
  `purpose_user_phone` varchar(64) DEFAULT NULL COMMENT '被联系对象手机号',
  `create_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT COMMENT '联系创建时间',
  `update_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '联系更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=55 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='联系记录';
```

## 收藏表（复用）

```mysql
CREATE TABLE `collect` (
  `user_id` int NOT NULL COMMENT '用户ID',
  `content_id` int NOT NULL COMMENT '业务对象ID（如招聘ID/简历ID/招租ID）',
  `type` tinyint NOT NULL COMMENT '业务类型：1=招聘 2=求职 3=招租',
  `status` int DEFAULT '1' COMMENT '状态: 1=生效 2=删除',
  `create_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
  `update_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
  PRIMARY KEY (`content_id`,`user_id`,`type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
```

## 联系券变更表（新建）

```mysql
CREATE TABLE `cost_history` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `user_id` bigint DEFAULT NULL COMMENT '发起联系的用户ID，对应 user.id',
  `biz_type` bigint DEFAULT NULL COMMENT '1=充值 2=消费',
  `change_num` int NOT NULL DEFAULT 0 COMMENT '变更数量',
  `last_num` int NOT NULL DEFAULT 0 COMMENT '变更前数量',
  `next_num` int NOT NULL DEFAULT 0 COMMENT '变更后数量',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注',
  `create_at` datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=55 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='联系券变更表'；
```

