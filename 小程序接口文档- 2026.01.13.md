# 小程序接口文档

生产环境：

测试环境：114.115.153.27:16789

## 一、用户模块

### 微信注册（首次，需手机号）

```json
// 接口地址：/wechat/user/register
// 请求方式：POST

// Header
Content-Type: application/json
Authorization: Bearer <token> // 登录成功后返回在响应头

// 请求体
{
  "phone_code": "test", 	// wx.getPhoneNumber 获取
  "login_code": "test",  	// wx.login 获取
  "inviter_id": 289     	// 邀请人，可为空
}

// 注册成功响应体：
{
    "code": 0,
    "message": "ok",
    "data": {
        "user_info": {
            "id": 298
        }
    }
}
```

### 微信登录（二次，无需手机号）

```json
// 接口地址：/wechat/user/login
// 请求方式：POST

// Header
Content-Type: application/json
Authorization: Bearer <token> // 登录成功后返回在响应头

// 请求体
{
  "login_code": "test" // wx.login 获取
}

// 登陆成功响应体：
{
    "code": 0,
    "message": "ok",
    "data": {
        "user_info": {
            "id": 298
        }
    }
}

// 登陆失败响应体
{
    "code": 404,
    "message": "Not Found",
    "data": "user not found"
}
```

### 微信支付

```json
// 接口地址：/wechat/pay
// 请求方式：POST

// Header
Content-Type: application/json
Authorization: Bearer <token>

// 请求体
{
    "order_id": 90001,
    "order_no": "CV202601101520151234", // 上一个请求生成的订单号
  	"price": 5.9
}

// 响应体：
{
    "code": 0,
    "message": "ok",
    "data": {}
}
```

### 查询个人信息

```json
// 接口地址：/user/info
// 请求方式：GET

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 响应体：
{
    "code": 0,
    "message": "ok",
    "data": {
        "user_id": 4882,
        "avatar": "https://cdn.xxx.com/avatar/4882.png",
        "name": "小周",
        "sex": 1, // 0=未知、1=男、2=女
        "phone": "13811111234",
    }
}
```

### 更新位置信息

每次登陆用户授权获取地理位置信息时都应该调用该接口刷新用户位置

```json
// 接口地址：/user/update/geo
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "first_area_id": 1,
    "second_area_id": 101,
    "third_area_id": 1001,
    "address": "北京市朝阳区XXXX",
    "longitude": 116.3974,
    "latitude": 39.9093
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": null
}
```

### 更新个人信息

```json
// 接口地址：/user/update/info
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "avatar": "https://cdn.xxx.com/avatar/4882.png",
    "name": "小周",
    "sex": 1,
    "phone": "13811111234",
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": null
}
```

### 我发布的

```json
// 接口地址：/jobs/my
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "biz_type": 1, // 1=招聘、2=求职、3=招租
    "page_num": 1,
    "page_size": 2
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": {
        "jobs": [
            {
                "id": 1173,
                "positions": "服务员",
                "salary_min": 8000,
    						"salary_max": 20000,
                "first_area_des": "北京市",
                "second_area_des": "北京市",
                "third_area_des": "朝阳区",
                "address": "北京市朝阳区三里屯太古里北区B1层XX餐厅",
                "create_at": "2026-01-10 13:20:15.123",
                "is_top": 1,
              	"last_refresh_time": "2026-01-10 13:20:15.123",
            }
        ],
        "total": 1
    }
}
```

### 我联系的

```json
// 接口地址：/contact_history/out
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
  	"biz_type": 1, // 1=招聘、2=求职、3=招租
    "page_num": 1,
    "page_size": 2
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": {
        "contacts": [
            {
                "id": 55,
                "positions": "后厨主管",
                "address": "希尔顿店",
                "purpose_user_name": "test",
                "create_at": "2026-01-10 14:10:12.123"
            }
        ],
        "total": 1
    }
}
```

### 联系我的

```json
// 接口地址：/contact_history/in
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "biz_type": 1, // 1=招聘、2=求职、3=招租
    "page_num": 1,
    "page_size": 2
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": {
        "contacts": [
            {
                "id": 55,
                "positions": "后厨主管",
                "address": "希尔顿店",
                "purpose_user_name": "test",
                "create_at": "2026-01-10 14:10:12.123"
            }
        ],
        "total": 1
    }
}
```

### 我收藏的

```json
// 接口地址：/collect/my
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "biz_type": 1, // 1=招聘、2=求职、3=招租
    "page_num": 1,
    "page_size": 2
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": {
        "jobs": [
            {
                "id": 1173,
                "positions": "服务员",
                "salary_min": 8000,
    						"salary_max": 20000,
                "first_area_des": "北京市",
                "second_area_des": "北京市",
                "third_area_des": "朝阳区",
                "address": "北京市朝阳区三里屯太古里北区B1层XX餐厅",
                "create_at": "2026-01-10 13:20:15.123",
                "is_top": 1,
              	"last_refresh_time": "2026-01-10 13:20:15.123",
            }
        ],
        "total": 1
    }
}
```

### 我的券包

```json
// 接口地址：/contact_voucher/my
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "page_num": 1,
    "page_size": 2
}

// 响应体
{
  "code": 200,
  "message": "",
  "data": {
    "contact_voucher_num": 10,
    "list": [
      {
        "id": 101,
        "type": "consume",
        "title": "拨打电话",
        "change_num": -1,
        "create_at": "2025-11-11 11:12:13"
      },
      {
        "id": 100,
        "type": "consume",
        "title": "拨打电话",
        "change_num": -1,
        "create_at": "2025-11-11 11:10:02"
      },
      {
        "id": 99,
        "type": "recharge",
        "title": "购买",
        "change_num": 10,
        "create_at": "2025-11-11 11:00:00"
      }
    ],
    "list_total": 10
  }
}
```

## 二、商家招聘模块

### 发布招聘信息（商家）

```json
// 接口地址：/job/create
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "positions": "服务员",
    "longitude": 116.397128,
    "latitude": 39.916527,
    "address": "北京市朝阳区三里屯太古里北区B1层XX餐厅",
    "contact": "13812341234",
    "description": "【工作内容】点单、上菜、收银协助；\n【要求】18-35岁，能适应晚班；\n【待遇】5000-6500元/月，包吃住，月休4天。",
    "photo_urls": ["https://cdn.xxx.com/job/1173/1.jpg,https://cdn.xxx.com/job/1173/2.jpg"],
    "first_area_id": 11,
    "first_area_des": "北京市",
    "second_area_id": 1101,
    "second_area_des": "北京市",
    "third_area_id": 110105,
    "third_area_des": "朝阳区",
    "four_area_id": 110105001,
    "four_area_des": "三里屯",
    "salary_min": 8000,
    "salary_max": 20000
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": null
}
```

### 置顶招聘信息（商家）

```json
// 接口地址：/job/top
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "job_id": 1234,
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": {
      "order_id": 90001,
      "order_no": "CV202601101520151234",
      "rule_id": 2,
      "price": 5.00,
      "currency": "CNY",
      "created_at": "2026-01-10 15:20:15.123"
    }
}
```

### 刷新招聘信息（商家）

```json
// 接口地址：/job/refresh
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "job_id": 1234,
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": null
}
```

### 修改招聘信息（商家）

```json
// 接口地址：/jobs/update
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "id": 39, // 必填参数
    "positions": "收银员",
    "longitude": 116.3974,
    "latitude": 39.9093,
    "address": "北京市朝阳区建国路88号",
    "contact": "13800138000",
    "description": "连锁餐饮店招聘服务员，包吃住，有经验者优先。",
    "photo_urls": "",
    "first_area_id": 1,
    "second_area_id": 101,
    "third_area_id": 1001,
    "user_name": "张老板",
    "first_area_des": "北京市",
    "second_area_des": "朝阳区",
    "third_area_des": "建外街道",
    "salary_min": 8000,
    "salary_max": 20000
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": null
}
```

### 关闭招聘信息（商家）

```json
// 接口地址：/job/close
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "job_id": 1234,
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": null
}
```

### 招聘信息列表（用户）

类型：推荐（刷新时间）、附近（距离）、最新（发布时间倒序）

筛选：岗位、薪资范围、基础保障、薪酬福利、考勤休假

```json
// 接口地址：/jobs/list
// 请求方式：POST

// Header
// 可以不带 token，此接口当前不会鉴权
Content-Type: application/json

// 请求体
{
    "request_id": "1234567",
    "query_type": 1, // 列表类型 1、推荐，2、附近、3、最新
    "filter": {
        "positions": "厨师长",
        "salary_min": 8000,
        "salary_max": 20000, // -1 时为无限大
        "basic_protection": [
            "社保",
            "公积金"
        ],
        "salary_benefits": [
            "节日福利"
        ],
        "attendance_leave": [],
        "longitude": 116.397128, // query_type = 2 时为必须参数
        "latitude": 39.916527, 	 // query_type = 2 时为必须参数
    },
    "page_num": 1,
    "page_size": 2
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": {
        "jobs": [
            {
                "id": 1173,
                "user_id": 4882,
                "positions": "服务员",
                "longitude": 116.397128,
                "latitude": 39.916527,
                "address": "北京市朝阳区三里屯太古里北区B1层XX餐厅",
                "contact": "138****1234",
                "description": "【工作内容】点单、上菜、收银协助；\n【要求】18-35岁，能适应晚班；\n【待遇】5000-6500元/月，包吃住，月休4天。",
                "photo_urls": [
                    "https://cdn.xxx.com/job/1173/1.jpg,https://cdn.xxx.com/job/1173/2.jpg"
                ],
                "status": 1,
                "fail_reason": "",
                "first_area_id": 11,
                "first_area_des": "北京市",
                "second_area_id": 1101,
                "second_area_des": "北京市",
                "third_area_id": 110105,
                "third_area_des": "朝阳区",
                "four_area_id": 110105001,
                "four_area_des": "三里屯",
                "create_at": "2026-01-10 13:20:15.123",
                "update_at": "2026-01-10 14:05:40.456",
                "audit_time": "2026-01-10 13:30:00",
                "refresh_time": 1736491200000,
                "is_top": 1,
                "top_hour": 72,
                "top_start_time": "2026-01-10 13:35:00",
                "top_end_time": "2026-01-13 13:35:00"
            },
            {
                "id": 1173,
                "user_id": 4882,
                "positions": "服务员",
                "longitude": 116.397128,
                "latitude": 39.916527,
                "address": "北京市朝阳区三里屯太古里北区B1层XX餐厅",
                "contact": "138****1234",
                "description": "【工作内容】点单、上菜、收银协助；\n【要求】18-35岁，能适应晚班；\n【待遇】5000-6500元/月，包吃住，月休4天。",
                "photo_urls": [
                    "https://cdn.xxx.com/job/1173/1.jpg,https://cdn.xxx.com/job/1173/2.jpg"
                ],
                "status": 1,
                "fail_reason": "",
                "first_area_id": 11,
                "first_area_des": "北京市",
                "second_area_id": 1101,
                "second_area_des": "北京市",
                "third_area_id": 110105,
                "third_area_des": "朝阳区",
                "four_area_id": 110105001,
                "four_area_des": "三里屯",
                "create_at": "2026-01-10 13:20:15.123",
                "update_at": "2026-01-10 14:05:40.456",
                "audit_time": "2026-01-10 13:30:00",
                "refresh_time": 1736491200000,
                "is_top": 1,
                "top_hour": 72,
                "top_start_time": "2026-01-10 13:35:00",
                "top_end_time": "2026-01-13 13:35:00"
            }
        ],
        "total": 4
    }
}
```

### 收藏（用户）

```json
// 接口地址：/job/collect
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "job_id": 1234,
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": null
}
```

### 取消收藏（用户）

```json
// 接口地址：/job/cancnel_collect
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
    "job_id": 1234,
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": null
}
```

### 查询详情

每当商家、用户点击某一条招聘，希望详细展开查看数据时使用

```json
// 接口地址：/jobs/info
// 请求方式：POST

// Header
// 可以不带 token，该接口不鉴权
Content-Type: application/json

// 请求体
{
    "job_id": "1234567",
}

// 响应体：
{
    "code": 200,
    "message": "",
    "data": {
        "id": 1173,
        "user_id": 4882,
        "positions": "服务员",
        "longitude": 116.397128,
        "latitude": 39.916527,
        "address": "北京市朝阳区三里屯太古里北区B1层XX餐厅",
        "contact": "138****1234",
        "description": "【工作内容】点单、上菜、收银协助；\n【要求】18-35岁，能适应晚班；\n【待遇】5000-6500元/月，包吃住，月休4天。",
        "photo_urls": [
            "https://cdn.xxx.com/job/1173/1.jpg,https://cdn.xxx.com/job/1173/2.jpg"
        ],
        "status": 1,
        "fail_reason": "",
        "first_area_id": 11,
        "first_area_des": "北京市",
        "second_area_id": 1101,
        "second_area_des": "北京市",
        "third_area_id": 110105,
        "third_area_des": "朝阳区",
        "four_area_id": 110105001,
        "four_area_des": "三里屯",
        "create_at": "2026-01-10 13:20:15.123",
        "update_at": "2026-01-10 14:05:40.456",
        "audit_time": "2026-01-10 13:30:00",
        "refresh_time": 1736491200000,
        "is_top": 1,
        "top_hour": 72,
        "top_start_time": "2026-01-10 13:35:00",
        "top_end_time": "2026-01-13 13:35:00"
    }
}
```

## 三、联系模块

### 充值

```json
// 接口地址：/contact_voucher/buy
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 请求体
{
  "price": 3.99, 						// 价格
  "contact_voucher_num": 1 	// 联系券数量
}

// 响应体
{
  "code": 200,
  "message": "",
  "data": {
    "order_id": 90001,
    "order_no": "CV202601101520151234",
    "buyer_user_id": 298,
    "contact_voucher_num": 5,
    "price": 3.99,
    "created_at": "2026-01-10 15:20:15.123"
  }
}
```

### 消费

```json
// 接口地址：/contact_voucher/cost
// 请求方式：POST

// Header
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 ID
Content-Type: application/json

// 响应体
{
  "code": 200,
  "message": "",
  "data": null
}
```

## 四、通用接口

### 图片上传

头像、广告图等，每一个图片都应该先单独上传，然后填链接

```json
// 接口地址：/img/upload
// 请求方式：POST

// Header
Content-Type: multipart/form-data
Authorization: "token" 									// 登陆接口返回的 TOKEN
user_id: 298													 	// 登陆接口返回的 IDs

// 参数
file            // 字段名
file(binary)    // 字段类型

// 限制
// 最多上传4张；支持 jpg/jpeg/png/bmp/webp；单张不超过20MB

// 响应体：
{
    "code": 0,
    "message": "ok",
    "data": {
        "url": "https://catering-cyxx-test.oss-cn-beijing.aliyuncs.com/img/298_1768292213248008000.png"
    }
}
```
